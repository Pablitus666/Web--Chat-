{
  "rules": {
    "rooms": {
      ".read": "auth != null",
      ".write": "auth != null"
    },
    "chats": {
      "$roomId": {
        ".read": true,
        // Permitir la escritura en 'lastActive' si es una marca de tiempo del servidor
        "lastActive": {
          ".write": "newData.val() == now"
        },
        "messages": {
          ".write": true,
          "$messageId": {
            ".validate": "newData.hasChildren(['text']) && newData.child('text').isString() && newData.child('text').val().length < 10000"
          }
        },
        "presences": {
          ".write": true,
          // Validar la nueva estructura de datos de presencia
          "$presenceId": {
            ".validate": "newData.hasChildren(['alias']) && newData.child('alias').isString() && newData.child('alias').val().length > 0 && newData.child('alias').val().length < 50"
          }
        },
        "keyCheck": {
          ".write": "!data.exists()",
          ".validate": "newData.isString()"
        }
      }
    }
  }
}